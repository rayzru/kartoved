# Docker Architecture - ĞšÑÑˆĞºĞ° (BuyWhyWhy)

**Ğ”Ğ°Ñ‚Ğ°:** 2026-02-07

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Ğ›ĞĞšĞĞ›Ğ¬ĞĞĞ¯ Ğ ĞĞ—Ğ ĞĞ‘ĞĞ¢ĞšĞ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Native App        â”‚       â”‚   Browser (pgAdmin)       â”‚
â”‚   (iOS/Android)           â”‚       â”‚   http://localhost:5050   â”‚
â”‚                           â”‚       â”‚                           â”‚
â”‚   - Mobile development    â”‚       â”‚   - PostgreSQL Web UI     â”‚
â”‚   - Expo / CLI            â”‚       â”‚   - Optional tool         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                   â”‚
              â”‚ HTTP API calls                    â”‚
              â”‚ http://localhost:3000             â”‚
              â”‚                                   â”‚
              â†“                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Network                            â”‚
â”‚                       buywhywhy-network                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            Backend ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ (Container)               â”‚    â”‚
â”‚  â”‚         buywhywhy-backend:3000                          â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Node.js 20 + TypeScript + Express                      â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Endpoints:                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ GET  /health                 âœ… Health check       â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ POST /api/auth/*             ğŸ” VK/Yandex/Email    â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ POST /api/ocr/bank-screenshot  ğŸ“¸ OCR             â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ POST /api/sync/push          ğŸ”„ Sync              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ POST /api/sync/pull          ğŸ”„ Sync              â”‚    â”‚
â”‚  â”‚  â””â”€â”€ POST /api/ai/classify-merchant ğŸ¤– AI/MCC          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Features:                                               â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Rate limiting (100 req/15min)                      â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Request logging (Winston)                          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Error handling                                     â”‚    â”‚
â”‚  â”‚  â””â”€â”€ CORS enabled                                       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Volumes (Hot Reload):                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ ./backend/src â†’ /app/src (code)                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€ backend_node_modules â†’ /app/node_modules          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                                             â”‚
â”‚                    â”‚ PostgreSQL Connection                       â”‚
â”‚                    â”‚ postgres://postgres:***@postgres:5432      â”‚
â”‚                    â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         PostgreSQL 16 Database (Container)                â”‚   â”‚
â”‚  â”‚              buywhywhy-postgres:5432                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Database: buywhywhy                                      â”‚   â”‚
â”‚  â”‚  User: postgres                                           â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Auto-init Ğ½Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ:                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ /docker-entrypoint-initdb.d/01-schema.sql          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ /docker-entrypoint-initdb.d/02-seed-mcc.sql        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ /docker-entrypoint-initdb.d/03-seed-banks.sql      â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ users (Ñ RLS)                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ russian_banks (4 Ğ±Ğ°Ğ½ĞºĞ°)                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ mcc_codes (50 ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹)                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ bank_cards                                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ card_cashback_rates                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ wifi_mcc_mapping                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€ widget_usage_stats                                  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Volume (ĞŸĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ):                               â”‚   â”‚
â”‚  â”‚  â””â”€â”€ postgres_data â†’ /var/lib/postgresql/data          â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Health Check:                                            â”‚   â”‚
â”‚  â”‚  â””â”€â”€ pg_isready -U postgres -d buywhywhy               â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Docker Volumes (Persistence)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  postgres_data          - PostgreSQL data (Ğ‘Ğ” Ğ½Ğµ Ñ‚ĞµÑ€ÑĞµÑ‚ÑÑ!)      â”‚
â”‚  backend_node_modules   - Node modules (Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ)       â”‚
â”‚  pgadmin_data          - pgAdmin settings                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow

### 1. Mobile App â†’ Backend â†’ Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mobile App  â”‚
â”‚ (React RN)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP POST /api/ocr/bank-screenshot
       â”‚ {image: File}
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ               â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Rate Limiter                â”‚  â”‚
â”‚ â”‚ (20 OCR/hour)               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ OCR Service                 â”‚  â”‚
â”‚ â”‚ - ML Kit (on-device 90%)    â”‚  â”‚
â”‚ â”‚ - AWS Textract (10%)        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Extract Categories          â”‚  â”‚
â”‚ â”‚ ["ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ 5%", "ĞšĞ°Ñ„Ğµ 3%"] â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Find MCC Codes              â”‚  â”‚
â”‚ â”‚ Query: mcc_codes table      â”‚â—„â”€â”¼â”€â”€â”€ PostgreSQL
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Save to user's bank_cards   â”‚  â”‚
â”‚ â”‚ INSERT card_cashback_rates  â”‚â—„â”€â”¼â”€â”€â”€ PostgreSQL
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Return Response             â”‚  â”‚
â”‚ â”‚ {categories: [...]}         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ JSON response
            â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Mobile App  â”‚
      â”‚ Display     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. WiFi Detection â†’ MCC Classification â†’ Best Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mobile App  â”‚
â”‚ Scan WiFi   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ WiFi SSID: "MagnoliaWiFi"
       â”‚ GET /api/ai/classify-merchant
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend AI Service                â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Query WiFi Mapping          â”‚  â”‚
â”‚ â”‚ SELECT * FROM wifi_mcc_     â”‚  â”‚
â”‚ â”‚   WHERE ssid = 'Magnolia%'  â”‚â—„â”€â”¼â”€â”€â”€ PostgreSQL
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    (wifi_mcc_mapping)
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Found: MCC 5411 (ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹)  â”‚  â”‚
â”‚ â”‚ Confidence: 0.95            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Get User's Cards            â”‚  â”‚
â”‚ â”‚ SELECT * FROM bank_cards    â”‚  â”‚
â”‚ â”‚   JOIN card_cashback_rates  â”‚â—„â”€â”¼â”€â”€â”€ PostgreSQL
â”‚ â”‚   WHERE mcc_code = '5411'   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Rank by Cashback %          â”‚  â”‚
â”‚ â”‚ 1. Ğ’Ğ¢Ğ‘ - 5%                 â”‚  â”‚
â”‚ â”‚ 2. Ğ¡Ğ±ĞµÑ€ - 3%                â”‚  â”‚
â”‚ â”‚ 3. ĞĞ»ÑŒÑ„Ğ° - 1.5%             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Return Best Card            â”‚  â”‚
â”‚ â”‚ {card: "Ğ’Ğ¢Ğ‘", percent: 5.0} â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ JSON response
            â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Mobile App  â”‚
      â”‚ Show Widget â”‚
      â”‚ "Ğ’Ğ¢Ğ‘ - 5%"  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      Ğ’Ñ€ĞµĞ¼Ñ: <1 ÑĞµĞºÑƒĞ½Ğ´Ğ° âš¡
```

---

## ğŸ”„ Development Modes

### Mode 1: Full Docker (Ğ’ÑĞµ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°Ñ…)

```
Developer Machine
â”œâ”€â”€ Docker Desktop
â”‚   â”œâ”€â”€ Container: Backend (Node.js)
â”‚   â”‚   â””â”€â”€ Hot Reload: volumes Ğ´Ğ»Ñ src/
â”‚   â””â”€â”€ Container: PostgreSQL
â”‚       â””â”€â”€ Persistent: postgres_data volume
â””â”€â”€ Code Editor (VS Code)
    â””â”€â”€ Edit: backend/src/*.ts
        â†’ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğµ
```

**Ğ—Ğ°Ğ¿ÑƒÑĞº:**
```bash
make up
make logs-backend  # Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ hot reload
```

### Mode 2: Local Backend + Docker DB (Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

```
Developer Machine
â”œâ”€â”€ Docker Desktop
â”‚   â””â”€â”€ Container: PostgreSQL (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”)
â”œâ”€â”€ Terminal
â”‚   â””â”€â”€ Backend: npm run dev (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)
â”‚       â””â”€â”€ ts-node-dev Ñ hot reload
â””â”€â”€ Code Editor (VS Code)
    â”œâ”€â”€ Edit: backend/src/*.ts
    â”‚   â†’ ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
    â””â”€â”€ Debugger: VS Code debugging Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚!
```

**Ğ—Ğ°Ğ¿ÑƒÑĞº:**
```bash
make dev-db-only       # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ PostgreSQL
cd backend && npm run dev  # Backend Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- âœ… Ğ‘Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ½Ğ° macOS/Windows
- âœ… Debugger Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- âœ… ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº node_modules

---

## ğŸ“¦ Multi-Stage Docker Build

```dockerfile
FROM node:20-alpine AS base
    â†“
    â”œâ”€â†’ FROM base AS development
    â”‚   â””â”€â”€ npm ci (Ğ²ÑĞµ deps)
    â”‚   â””â”€â”€ CMD ["npm", "run", "dev"]
    â”‚   â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: docker-compose.yml
    â”‚
    â””â”€â†’ FROM base AS builder
        â””â”€â”€ npm ci
        â””â”€â”€ npm run build â†’ dist/
        â””â”€â”€ npm prune --production
            â†“
            â””â”€â†’ FROM node:20-alpine AS production
                â””â”€â”€ COPY dist/
                â””â”€â”€ COPY node_modules/
                â””â”€â”€ CMD ["node", "dist/index.js"]
                â””â”€â”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: Production deploy
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- Development image: ~800MB (Ñ devDependencies)
- Production image: ~200MB (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ runtime)

---

## ğŸš€ Deployment Flow

### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° â†’ Production

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Local Development    â”‚
â”‚ make up              â”‚
â”‚ make dev-backend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git commit & push
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Git Repository       â”‚
â”‚ (GitHub/GitLab)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git pull
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VPS Server           â”‚
â”‚ (Selectel/Timeweb)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. git pull          â”‚
â”‚ 2. docker-compose    â”‚
â”‚    -f compose.prod   â”‚
â”‚    up -d --build     â”‚
â”‚                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Nginx :80/443  â”‚   â”‚
â”‚ â”‚ Reverse Proxy  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚           â”‚
â”‚          â†“           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Backend :3000  â”‚   â”‚
â”‚ â”‚ (Production)   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚           â”‚
â”‚          â†“           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ PostgreSQL     â”‚   â”‚
â”‚ â”‚ :5432          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Production checklist:**
- âœ… Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ² .env
- âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ production Dockerfile stage
- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Nginx reverse proxy
- âœ… Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ SSL (Let's Encrypt)
- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ backup PostgreSQL
- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ (Prometheus/Grafana)

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Network Level (Docker Network)                       â”‚
â”‚     â”œâ”€â”€ Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑĞµÑ‚ÑŒ buywhywhy-network            â”‚
â”‚     â”œâ”€â”€ PostgreSQL Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ´Ğ»Ñ backend          â”‚
â”‚     â””â”€â”€ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµÑ€ĞµĞ· exposed ports       â”‚
â”‚                                                          â”‚
â”‚  2. Application Level (Backend)                          â”‚
â”‚     â”œâ”€â”€ Helmet.js (Security headers)                    â”‚
â”‚     â”œâ”€â”€ CORS (Only allowed origins)                     â”‚
â”‚     â”œâ”€â”€ Rate Limiting (100 req/15min)                   â”‚
â”‚     â”œâ”€â”€ JWT Authentication                              â”‚
â”‚     â””â”€â”€ Request validation (Zod)                        â”‚
â”‚                                                          â”‚
â”‚  3. Database Level (PostgreSQL)                          â”‚
â”‚     â”œâ”€â”€ Row Level Security (RLS) policies               â”‚
â”‚     â”œâ”€â”€ Encrypted connections (SSL Ğ² production)        â”‚
â”‚     â”œâ”€â”€ User isolation (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)â”‚
â”‚     â””â”€â”€ Prepared statements (SQL injection Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°)      â”‚
â”‚                                                          â”‚
â”‚  4. Container Level (Docker)                             â”‚
â”‚     â”œâ”€â”€ Non-root user Ğ² production                      â”‚
â”‚     â”œâ”€â”€ Read-only file systems Ğ³Ğ´Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾             â”‚
â”‚     â””â”€â”€ Limited resources (CPU/Memory limits)           â”‚
â”‚                                                          â”‚
â”‚  5. Data Level                                           â”‚
â”‚     â”œâ”€â”€ NO sensitive data storage (no card numbers)     â”‚
â”‚     â”œâ”€â”€ JWT tokens (Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ğ¸)                   â”‚
â”‚     â””â”€â”€ Encrypted env variables Ğ² production            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Monitoring & Observability (Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Observability Stack                   â”‚
â”‚                      (Phase 2+)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Prometheus    â”‚â—„â”€â”€â”€â”€â”€â”‚   Backend       â”‚         â”‚
â”‚  â”‚   :9090         â”‚      â”‚   /metrics      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                            â”‚
â”‚           â”‚ Scrape metrics                             â”‚
â”‚           â†“                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚   Grafana       â”‚                                  â”‚
â”‚  â”‚   :3001         â”‚                                  â”‚
â”‚  â”‚                 â”‚                                  â”‚
â”‚  â”‚  Dashboards:    â”‚                                  â”‚
â”‚  â”‚  â”œâ”€â”€ API Latency                                  â”‚
â”‚  â”‚  â”œâ”€â”€ Error Rate                                   â”‚
â”‚  â”‚  â”œâ”€â”€ DB Connections                               â”‚
â”‚  â”‚  â””â”€â”€ OCR Usage                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Loki          â”‚â—„â”€â”€â”€â”€â”€â”‚   Docker Logs   â”‚         â”‚
â”‚  â”‚   Log Aggregationâ”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Next Steps

1. âœ… **Infrastructure Ready** - Docker setup Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½
2. â³ **Test Infrastructure** - `make up && make health`
3. ğŸ”œ **Implement Backend** - TODO endpoints (auth, OCR, sync, AI)
4. ğŸ”œ **Initialize React Native** - Ğ¡Ğ¼. NEXT_STEPS.md
5. ğŸ”œ **Integration Testing** - Mobile app â†” Backend â†” Database

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:**
- [DOCKER_SETUP.md](../DOCKER_SETUP.md) - Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ
- [README.md](../README.md) - ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- [NEXT_STEPS.md](../NEXT_STEPS.md) - Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2026-02-07
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0
