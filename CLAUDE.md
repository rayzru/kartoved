# –ö–∞—Ä—Ç–æ–≤–µ–¥ - –ó–Ω–∞—Ç–æ–∫ —Ç–≤–æ–∏—Ö –∫–∞—Ä—Ç

## Project Overview

**–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** **–ö–∞—Ä—Ç–æ–≤–µ–¥** üí≥üéì
- –ö–∞—Ä—Ç–æ + –≤–µ–¥ (–≤–µ–¥–∞—Ç—å = –∑–Ω–∞—Ç—å)
- –ê–Ω–∞–ª–æ–≥–∏—è: –ö—Ä–∞–µ–≤–µ–¥, –ò—Å–∫—É—Å—Å—Ç–≤–æ–≤–µ–¥ ‚Üí –ö–∞—Ä—Ç–æ–≤–µ–¥
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ä–µ—á–∏: "–ö–∞—Ä—Ç–æ–≤–µ–¥ –ø–æ–¥—Å–∫–∞–∂–µ—Ç", "–°–ø—Ä–æ—à—É –ö–∞—Ä—Ç–æ–≤–µ–¥–∞"
- –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∞—Ä—Ç–∞–º, –∑–Ω–∞—Ç–æ–∫ –∫–µ—à–±—ç–∫–∞
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ: –°–º–µ–∫–∞–ª–∫–∞, –ü–æ–¥—Å–∫–∞–∂–∏, –ö–æ–ø–µ–π–∫–∞

**–¢–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** –ö–∞—Ä–º–∞–Ω–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç-—Å–æ–≤–µ—Ç–Ω–∏–∫ –ø–æ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º

**–ì–ª–∞–≤–Ω–∞—è —Ñ–∏—á–∞:** –í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞ <1 —Å–µ–∫ –∫–∞–∫–æ–π –∫–∞—Ä—Ç–æ–π –ø–ª–∞—Ç–∏—Ç—å –°–ï–ô–ß–ê–°

**UX Philosophy:**
- –ü—Ä–æ—Å—Ç–æ–π –∏ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –≤—ã–±–æ—Ä –ø–µ—Ä–µ–¥ –∫–∞—Å—Å–æ–π
- –ï–∂–µ–º–µ—Å—è—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–æ—Å–ª–µ 1 —á–∏—Å–ª–∞)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è

**–ì–µ–æ–≥—Ä–∞—Ñ–∏—è:** –†–æ—Å—Å–∏—è/–°–ù–ì
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç - –º–∏–Ω–∏–º—É–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –¥–æ proof-of-concept

---

## Tech Stack (React Native)

### Frontend
- **Framework:** React Native 0.76.5
- **Language:** TypeScript 5.4+ (strict mode)
- **State Management:** Zustand 4.5 + React Query 5.0
- **Navigation:** React Navigation 7.0
- **UI:** React Native Paper + custom components
- **Widget:** React Native Widget (iOS 14+, Android 12+)

### Authentication (–¢–æ–ª—å–∫–æ –∑–∞–∫–æ–Ω–Ω—ã–µ –≤ –†–§!)
**üö® –ö–†–ò–¢–ò–ß–ù–û:** –° –¥–µ–∫–∞–±—Ä—è 2025 –∑–∞–ø—Ä–µ—â–µ–Ω—ã Google/Apple ID (—à—Ç—Ä–∞—Ñ 700K‚ÇΩ)

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –º–µ—Ç–æ–¥—ã:**
- **VK ID:** @vkid/sdk-react-native (OAuth 2.0) - Primary
- **Yandex ID:** expo-auth-session (OAuth) - Primary
- **Email/Password:** Supabase Auth (fallback)

**–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (Phase 2):**
- **SMS / Phone:** Supabase Auth Phone (~1-3‚ÇΩ –∑–∞ SMS)
- **–ì–æ—Å—É—Å–ª—É–≥–∏ (–ï–°–ò–ê):** –û—Ç–ª–æ–∂–µ–Ω–æ (—Å–ª–æ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–ó–ê–ü–†–ï–©–ï–ù–û:**
- ‚ùå Google Sign-In
- ‚ùå Apple ID
- ‚ùå Facebook Login

### Local Database (Offline-First)
- **Database:** WatermelonDB (SQLite wrapper)
- **Sync:** PowerSync (bidirectional sync)
- **Storage:** expo-sqlite

### Backend (Supabase)
- **Database:** PostgreSQL + Row Level Security
- **Auth:** Supabase Auth + VK/Yandex OAuth
- **Real-time:** Supabase Realtime (–ø—Ä–æ–º–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- **Functions:** Edge Functions (–ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–º–æ, –ò–ò)
- **Storage:** Supabase Storage (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã OCR)

### AI/ML
- **OCR:** ML Kit (on-device 90%) + AWS Textract (cloud 10%)
- **Voice:** expo-speech + –Ø–Ω–¥–µ–∫—Å SpeechKit
- **AI Classification:** Yandex GPT (–º–∞–≥–∞–∑–∏–Ω ‚Üí MCC –∫–æ–¥)

### Location
- **Primary:** WiFi SSID scanning (react-native-wifi-reborn)
- **Fallback:** GPS + –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## Core Architecture

### MCC –∫–æ–¥—ã (Merchant Category Codes)
**–ö–†–ò–¢–ò–ß–ù–û:** –ë–∞–Ω–∫–∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç –∫–µ—à–±—ç–∫–∏ –∫ MCC –∫–æ–¥–∞–º - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫

**–ü—Ä–∏–º–µ—Ä—ã:**
- MCC 5411 = –ü—Ä–æ–¥—É–∫—Ç—ã (–ü—è—Ç—ë—Ä–æ—á–∫–∞, –ú–∞–≥–Ω–∏—Ç, –ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫)
- MCC 5814 = –§–∞—Å—Ç—Ñ—É–¥ (–ú–∞–∫–¥–æ–Ω–∞–ª—å–¥—Å, KFC, –®–æ–∫–æ–ª–∞–¥–Ω–∏—Ü–∞)
- MCC 5542 = –ê–ó–° (–õ—É–∫–æ–π–ª, –ì–∞–∑–ø—Ä–æ–º, –†–æ—Å–Ω–µ—Ñ—Ç—å)
- MCC 4121 = –¢–∞–∫—Å–∏ (–Ø–Ω–¥–µ–∫—Å.–¢–∞–∫—Å–∏, Uber)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç
         ‚Üì
WiFi SSID "MagnoliaWiFi" ‚Üí –ú–∞–≥–Ω–∏—Ç ‚Üí MCC 5411
  –ò–õ–ò
–ì–æ–ª–æ—Å "–ü—è—Ç—ë—Ä–æ—á–∫–∞" ‚Üí –ò–ò ‚Üí MCC 5411
  –ò–õ–ò
–ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥—É–∫—Ç—ã" ‚Üí MCC 5411
         ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –°–±–µ—Ä: –Ω–µ—Ç –∫–µ—à–±—ç–∫–∞ –Ω–∞ MCC 5411
- –í–¢–ë: 5% –Ω–∞ MCC 5411 ‚úÖ
- –ê–ª—å—Ñ–∞: 2% –Ω–∞ MCC 5411
         ‚Üì
–í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: [–õ–û–ì–û –í–¢–ë] 5%
         ‚Üì
–í—Ä–µ–º—è: <1 —Å–µ–∫—É–Ω–¥–∞ (–ö–†–ò–¢–ò–ß–ù–û!)
```

### Data Model (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–ª—è MVP)

```
User (–ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç)
‚îú‚îÄ‚îÄ Auth (VK ID / Yandex ID / Email)
‚îú‚îÄ‚îÄ BankCards
‚îÇ   ‚îú‚îÄ‚îÄ bank_name (–°–±–µ—Ä/–í–¢–ë/–ê–ª—å—Ñ–∞/–¢-–ë–∞–Ω–∫/–û—Ç–∫—Ä—ã—Ç–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ bank_logo_url
‚îÇ   ‚îî‚îÄ‚îÄ CardCashbackRates
‚îÇ       ‚îú‚îÄ‚îÄ mcc_code (5411, 5814, 5542...)
‚îÇ       ‚îú‚îÄ‚îÄ category_name_ru ("–ü—Ä–æ–¥—É–∫—Ç—ã", "–ö–∞—Ñ–µ")
‚îÇ       ‚îú‚îÄ‚îÄ cashback_percent (5.0%)
‚îÇ       ‚îî‚îÄ‚îÄ valid_until (–∫–æ–Ω–µ—Ü –º–µ—Å—è—Ü–∞)
‚îÇ
‚îî‚îÄ‚îÄ WidgetUsageStats
    ‚îú‚îÄ‚îÄ total_uses
    ‚îú‚îÄ‚îÄ estimated_savings_rub
    ‚îî‚îÄ‚îÄ last_used_at

MCC_Database (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, ~1000 –∑–∞–ø–∏—Å–µ–π)
‚îú‚îÄ‚îÄ mcc_code (5411)
‚îú‚îÄ‚îÄ category_name_ru ("–ü—Ä–æ–¥—É–∫—Ç—ã")
‚îú‚îÄ‚îÄ category_name_en ("Groceries")
‚îî‚îÄ‚îÄ common_merchants (["–ü—è—Ç—ë—Ä–æ—á–∫–∞", "–ú–∞–≥–Ω–∏—Ç"])

WiFi_MCC_Mapping (–∫—Ä–∞—É–¥—Å–æ—Ä—Å–∏–Ω–≥)
‚îú‚îÄ‚îÄ wifi_ssid ("MagnoliaWiFi")
‚îú‚îÄ‚îÄ merchant_name ("–ú–∞–≥–Ω–∏—Ç")
‚îú‚îÄ‚îÄ mcc_code (5411)
‚îî‚îÄ‚îÄ confidence_score (0.95)
```

---

## MVP Features (Phase 1 - 6 –Ω–µ–¥–µ–ª—å)

### 1. ‚ö° –ë–´–°–¢–†–´–ô –í–ò–î–ñ–ï–¢ (–≥–ª–∞–≤–Ω–∞—è —Ñ–∏—á–∞!)
- –ü–æ–∫–∞–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã (–ª–æ–≥–æ –±–∞–Ω–∫–∞)
- 3 —Å–ø–æ—Å–æ–±–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
  - Auto: WiFi SSID ‚Üí MCC –∫–æ–¥ ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
  - –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä: –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ü—Ä–æ–¥—É–∫—Ç—ã/–ö–∞—Ñ–µ/–ê–ó–°/–¢–∞–∫—Å–∏...)
  - –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥: "–ü—è—Ç—ë—Ä–æ—á–∫–∞" ‚Üí –ò–ò ‚Üí MCC 5411
- **Target:** <1 —Å–µ–∫—É–Ω–¥–∞ –æ—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–æ –ø–æ–∫–∞–∑–∞ –∫–∞—Ä—Ç—ã

### 2. üéØ Auth (—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã)
- VK ID OAuth
- Yandex ID OAuth
- Email+–ø–∞—Ä–æ–ª—å fallback
- **–ë–ï–ó —Å–µ–º–µ–π–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ MVP** (—Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–π)

### 3. üì∏ –í–≤–æ–¥ –∫–µ—à–±—ç–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (3 —Å–ø–æ—Å–æ–±–∞)
- –°–∫—Ä–∏–Ω—à–æ—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ app ‚Üí OCR ‚Üí MCC –∫–æ–¥—ã
- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥: "5% –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ –°–±–µ—Ä—É"
- –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä: –ë–∞–Ω–∫ ‚Üí MCC –∫–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üí %

### 4. üóÉÔ∏è MCC –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + –ë–∞–Ω–∫–∏ –†–§
- ~1000 MCC –∫–æ–¥–æ–≤ (—Ä–æ—Å—Å–∏–π—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è ISO 18245)
- WiFi SSID ‚Üí MCC mapping
- **–¢–æ–ø-4 –±–∞–Ω–∫–∞ –†–§ –¥–ª—è MVP:**
  1. **–°–±–µ—Ä–±–∞–Ω–∫ (–°–±–µ—Ä–°–ø–∞—Å–∏–±–æ)** - 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –¥–æ 6 –¥–ª—è –ø—Ä–µ–º–∏—É–º
  2. **–¢-–ë–∞–Ω–∫ (–¢–∏–Ω—å–∫–æ—Ñ—Ñ)** - 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –¥–æ 15% –∫–µ—à–±—ç–∫
  3. **–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫** - 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
  4. **–í–¢–ë** - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –¥–æ 15%
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (seed –¥–∞–Ω–Ω—ã–µ)

### 5. üìä –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –°—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –≤–∏–¥–∂–µ—Ç–∞
- "–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ ~X —Ä—É–± —ç—Ç–æ—Ç –º–µ—Å—è—Ü"

### –ß–¢–û –û–¢–ö–õ–ê–î–´–í–ê–ï–ú –Ω–∞ Phase 2+
- ‚ùå OCR —á–µ–∫–æ–≤ (–Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è MVP!)
- ‚ùå –°–µ–º–µ–π–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- ‚ùå –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–∞—Ç
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–º–æ
- ‚ùå Background geofencing

---

## Architecture Principles

### 1. Local-First
- App —Ä–∞–±–æ—Ç–∞–µ—Ç offline
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ –≤ SQLite (WatermelonDB)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–∞—è —á–µ—Ä–µ–∑ PowerSync
- Cached recommendations –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞ –≤–∏–¥–∂–µ—Ç–∞

### 2. Privacy-First
- **ZERO sensitive data** - –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏–º:
  - ‚ùå –ü–æ–ª–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
  - ‚ùå CVV –∫–æ–¥—ã
  - ‚ùå PIN –∫–æ–¥—ã
- –¢–æ–ª—å–∫–æ: –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞, MCC –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, % –∫–µ—à–±—ç–∫–∞
- RLS policies –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã)

### 3. Cost-Optimized
- 90% OCR on-device (ML Kit - –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- 10% cloud OCR fallback (AWS Textract - $30/–º–µ—Å –º–∞–∫—Å)
- Supabase Free tier –¥–æ 500 MAU
- VK ID / Yandex ID - –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **Target:** <$50/–º–µ—Å –¥–æ 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. Performance
- **–í–∏–¥–∂–µ—Ç <1 —Å–µ–∫** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ç—Ä–∏–∫–∞ UX
- 60 FPS scrolling (budget Android Snapdragon 600-series)
- <2 sec —Ö–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç app
- <3 sec on-device OCR

---

## Development Guidelines

### Code Style
- **TypeScript strict mode** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- **ESLint + Prettier** –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ:**
  - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: PascalCase (WidgetCard.tsx)
  - –§–∞–π–ª—ã: camelCase (useCashbackStore.ts)
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã: UPPER_SNAKE_CASE (MCC_CODES)
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
  - JSDoc –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
  - Inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
  - –†—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ OK –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### Testing
- **Unit tests:** Jest (coverage >70% –¥–ª—è core logic)
- **E2E tests:** Detox (critical user flows)
- **Performance tests:** React DevTools Profiler
- Test —Ñ–∞–π–ª—ã: `*.test.ts`, `*.test.tsx`

### Git Flow
- **Branches:** `feature/widget-implementation`, `fix/ocr-accuracy`
- **Commits:** Semantic commits
  - `feat: –¥–æ–±–∞–≤–ª–µ–Ω –≤–∏–¥–∂–µ—Ç —Å WiFi –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º`
  - `fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω OCR –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –°–±–µ—Ä–∞`
  - `perf: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ MCC –±–∞–∑—ã`
- **PRs:** Self-review –ø–µ—Ä–µ–¥ merge –≤ main
- **CI/CD:** –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–¥ merge

### Performance
- **Profile before optimize** (React DevTools, Flipper)
- **Lazy loading** –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ (FlatList, VirtualizedList)
- **Memoization** –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (useMemo, memo)
- **Image optimization** (WebP, cached, compressed)

---

## Critical Constraints

### Solo Developer
- Prioritize simplicity over perfection
- MVP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª > –∫—Ä–∞—Å–∏–≤—ã–π UI
- Hardcoded –¥–∞–Ω–Ω—ã–µ > –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–¥–ª—è MVP)
- Reuse libraries > –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å –Ω—É–ª—è

### Budget
- **$2-3K/–≥–æ–¥ –º–∞–∫—Å–∏–º—É–º** (–¥–æ monetization)
- Free tiers –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ú–∏–Ω–∏–º—É–º cloud costs (on-device –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### Timeline
- **6 –Ω–µ–¥–µ–ª—å –¥–æ MVP beta**
- 30 beta –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–∏–Ω–∏–º—É–º –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- –ï—Å–ª–∏ "–Ω–µ –ø–æ–ª–µ—Ç–∏—Ç" - pivot –∏–ª–∏ stop

---

## Security & Privacy

### Data Storage
- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏–º:**
  - –ü–æ–ª–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
  - CVV/CVC –∫–æ–¥—ã
  - PIN –∫–æ–¥—ã
- **–•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ:**
  - –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞
  - MCC –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å % –∫–µ—à–±—ç–∫–∞
  - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### RLS Policies
- –ö–∞–∂–¥—ã–π user –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ò–∑–æ–ª—è—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL
- Supabase Auth + Row Level Security

### Encryption
- react-native-keychain –¥–ª—è credentials
- Biometric unlock –¥–ª—è app access
- HTTPS everywhere (Supabase enforces)

---

## Success Metrics (MVP)

### Phase 1 Success Criteria (–Ω–µ–¥–µ–ª—è 6):
- ‚úÖ 30 beta –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í–∏–¥–∂–µ—Ç <1 —Å–µ–∫ –≤ 90% —Å–ª—É—á–∞–µ–≤
- ‚úÖ 70%+ OCR accuracy (–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã)
- ‚úÖ 60%+ WiFi auto-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏
- ‚úÖ 5+ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –≤–∏–¥–∂–µ—Ç–∞/–Ω–µ–¥–µ–ª—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ <$50/–º–µ—Å infrastructure costs

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –ù–ï –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã:
- <20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = pivot –∏–ª–∏ stop
- –í–∏–¥–∂–µ—Ç >2 —Å–µ–∫ = optimize or rethink UX
- OCR <50% = cloud fallback 100% (–¥–æ—Ä–æ–∂–µ)

---

## File Structure

```
/Users/arumm/buywhywhy/
‚îú‚îÄ‚îÄ CLAUDE.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª (project context)
‚îú‚îÄ‚îÄ PLAN_SUMMARY.md              # –ö—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω (Russian)
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ app.json
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/              # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Widget/              # –í–∏–¥–∂–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BankCard/            # –ö–∞—Ä—Ç–æ—á–∫–∏ –±–∞–Ω–∫–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/              # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ screens/                 # –≠–∫—Ä–∞–Ω—ã app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WidgetScreen.tsx     # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –≤–∏–¥–∂–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OnboardingScreen.tsx # Auth + onboarding
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CardsScreen.tsx      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatsScreen.tsx      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ store/                   # State management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuthStore.ts      # Auth (VK/Yandex/Email)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useCardsStore.ts     # –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useWidgetStore.ts    # –í–∏–¥–∂–µ—Ç state
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useMCCStore.ts       # MCC –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OCRService.ts        # Hybrid OCR (ML Kit + Textract)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LocationService.ts   # WiFi + GPS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VoiceService.ts      # Speech-to-text
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AIService.ts         # Yandex GPT (–Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí MCC)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CashbackEngine.ts    # –ú–∞—Ç—á–∏–Ω–≥ –∫–µ—à–±—ç–∫–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/                # Local SQLite
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.ts            # WatermelonDB schema
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/              # Models
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BankCard.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CashbackRate.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WidgetUsage.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ lib/                     # Utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts          # Supabase client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mccCodes.ts          # MCC —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ russianBanks.ts      # –ë–∞–Ω–∫–∏ –†–§ + –ª–æ–≥–æ—Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.ts         # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ types/                   # TypeScript types
‚îÇ       ‚îú‚îÄ‚îÄ mcc.types.ts
‚îÇ       ‚îú‚îÄ‚îÄ bank.types.ts
‚îÇ       ‚îî‚îÄ‚îÄ widget.types.ts
‚îÇ
‚îú‚îÄ‚îÄ database/                    # Backend (Supabase)
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql               # PostgreSQL schema + RLS
‚îÇ   ‚îú‚îÄ‚îÄ mcc_codes.sql            # MCC —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ seed
‚îÇ   ‚îî‚îÄ‚îÄ russian_banks.sql        # –†–æ—Å—Å–∏–π—Å–∫–∏–µ –±–∞–Ω–∫–∏ seed
‚îÇ
‚îî‚îÄ‚îÄ supabase/
    ‚îú‚îÄ‚îÄ config.toml
    ‚îî‚îÄ‚îÄ functions/               # Edge Functions
        ‚îú‚îÄ‚îÄ ai-classify/         # Yandex GPT (–Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí MCC)
        ‚îî‚îÄ‚îÄ promo-scraper/       # –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–º–æ (Phase 2)
```

---

## Quick Commands

```bash
# Development
npm start                # Start Metro bundler
npm run ios              # Run on iOS simulator
npm run android          # Run on Android emulator

# Testing
npm test                 # Run Jest unit tests
npm run test:e2e         # Run Detox E2E tests
npm run test:watch       # Watch mode

# Code Quality
npm run lint             # ESLint
npm run format           # Prettier
npm run typecheck        # TypeScript check

# Database
npm run db:migrate       # Run migrations
npm run db:seed          # Seed MCC codes + banks
```

---

## Working with Claude Code

### Use specialized agents:
- **React Native issues:** javascript-typescript:javascript-pro
- **TypeScript types:** javascript-typescript:typescript-pro
- **Code review:** pr-review-toolkit:code-reviewer
- **Auth implementation:** developer-essentials:auth-implementation-patterns
- **SQL/RLS:** developer-essentials:sql-optimization-patterns

### Development workflow:
```bash
# 1. New feature
git checkout -b feature/widget-voice-input
# Ask Claude: "Help me implement voice input for widget"

# 2. Code review
# Say: "/review" or "Review recent changes"

# 3. TypeScript errors
# Say: "Fix TypeScript strict mode errors in WidgetStore"

# 4. Performance issues
# Say: "Profile and optimize widget rendering"
```

---

## Next Steps (Week 1)

### Day 1-2: Project Setup
- [ ] Initialize React Native project
- [ ] Setup TypeScript + ESLint + Prettier
- [ ] Configure Supabase project
- [ ] Create database schema (users, bank_cards, mcc_codes)

### Day 3-4: Auth Implementation
- [ ] VK ID OAuth integration
- [ ] Yandex ID OAuth integration
- [ ] Supabase Auth setup
- [ ] Biometric unlock (react-native-biometrics)

### Day 5: MCC Database
- [ ] Create MCC codes table (~1000 entries)
- [ ] Seed Russian banks (–°–±–µ—Ä/–í–¢–ë/–ê–ª—å—Ñ–∞/–¢-–ë–∞–Ω–∫/–û—Ç–∫—Ä—ã—Ç–∏–µ)
- [ ] Create WiFi ‚Üí MCC mapping structure

**Timeline:** 6 –Ω–µ–¥–µ–ª—å –¥–æ MVP beta —Å 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ üöÄ
